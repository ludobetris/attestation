<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Attestation de Suivi - Solioz & Merkli Travaux Publics SA</title>
  <!-- Import de la librairie jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
      body {
          margin: 0;
          padding: 0;
          font-family: Arial, sans-serif;
          background-color: #f4f4f4;
          text-align: center;
      }
      .container {
          width: 90%;
          max-width: 600px;
          margin: 20px auto;
          background: #fff;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      h2 {
          color: #2c3e50;
          font-size: 22px;
          margin-bottom: 20px;
      }
      .logo {
          width: 120px;
          margin-bottom: 20px;
      }
      form {
          display: flex;
          flex-direction: column;
          align-items: center;
      }
      input {
          width: 80%;
          padding: 12px;
          margin-top: 10px;
          font-size: 16px;
          border: 1px solid #ccc;
          border-radius: 5px;
          text-align: center;
      }
      canvas {
          border: 2px solid #2c3e50;
          margin: 20px 0;
          border-radius: 5px;
          background-color: #fff;
      }
      .btn {
          background-color: #2c3e50;
          color: #fff;
          cursor: pointer;
          border: none;
          padding: 12px 20px;
          font-size: 16px;
          border-radius: 5px;
          margin-top: 15px;
      }
      .btn:hover {
          background-color: #34495e;
      }
      .signature-btn {
          margin-top: 10px;
          background-color: #e74c3c;
      }
      .signature-btn:hover {
          background-color: #c0392b;
      }
  </style>
</head>
<body>
  <div class="container">
    <img
      src="https://github.com/ludobetris/3d-models/raw/main/logo___2019.png"
      class="logo"
      alt="Solioz & Merkli"
    />
    <h2>Attestation de Suivi du Cours de Premiers Secours</h2>

    <form id="attestationForm">
      <input type="text" id="nom" placeholder="Nom" required />
      <input type="text" id="prenom" placeholder="Prénom" required />
      <p><strong>Date :</strong> <span id="dateActuelle"></span></p>

      <canvas id="signatureCanvas" width="300" height="150"></canvas>
      <button type="button" class="btn signature-btn" onclick="effacerSignature()">Effacer la signature</button>

      <button type="button" class="btn" onclick="genererPDF()">Générer PDF & Télécharger</button>
    </form>
  </div>

  <script>
    // --- Affichage de la date actuelle ---
    document.getElementById('dateActuelle').innerText = new Date().toLocaleDateString();

    // --- Gestion de la signature ---
    let canvas = document.getElementById('signatureCanvas');
    let ctx = canvas.getContext('2d');
    let drawing = false;

    canvas.addEventListener('mousedown', function(event) {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(event.offsetX, event.offsetY);
    });

    canvas.addEventListener('mousemove', function(event) {
      if (drawing) {
        ctx.lineTo(event.offsetX, event.offsetY);
        ctx.stroke();
      }
    });

    canvas.addEventListener('mouseup', function() {
      drawing = false;
    });

    function effacerSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // --- Génération et téléchargement du PDF ---
    async function genererPDF() {
      const { jsPDF } = window.jspdf;

      let nom = document.getElementById('nom').value.trim();
      let prenom = document.getElementById('prenom').value.trim();
      let date = document.getElementById('dateActuelle').innerText;

      if (!nom || !prenom) {
        alert("Veuillez remplir tous les champs.");
        return;
      }

      // Conversion de la signature en image
      let signatureImage = canvas.toDataURL("image/png");

      // Création du document PDF (format A4)
      let doc = new jsPDF("p", "mm", "a4");

      // Titre principal
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(20);
      doc.text("Attestation de Suivi", 105, 20, { align: "center" });

      doc.setFontSize(14);
      doc.text("Formation Premiers Secours", 105, 30, { align: "center" });

      // Infos
      doc.setFont("Helvetica", "normal");
      doc.setFontSize(12);
      doc.text("Solioz & Merkli Travaux Publics SA", 20, 45);

      doc.text(`Nom : ${nom}`, 20, 55);
      doc.text(`Prénom : ${prenom}`, 20, 60);
      doc.text(`Date : ${date}`, 20, 65);

      doc.text("Formatrice : Aurore Besse", 20, 75);

      // Thèmes suivis
      const themes = [
        "Chaîne de secours",
        "Législation",
        "ORA",
        "Numéros d'urgence",
        "RCP",
        "Insolation, coups de chaleur",
        "Hémorragie externe",
        "Électrocution",
        "Blessure par écrasement",
        "Étouffement",
        "Choc anaphylactique",
        "Crise cardiaque",
        "AVC"
      ];

      doc.text("Thèmes abordés :", 20, 85);
      let yPosition = 90;
      themes.forEach(theme => {
        doc.text(`- ${theme}`, 25, yPosition);
        yPosition += 5;
      });

      // Signature
      doc.text("Signature du participant :", 20, yPosition + 10);
      doc.addImage(signatureImage, "PNG", 20, yPosition + 15, 80, 40);

      // Nom du fichier PDF
      let fileName = `Attestation_${nom}_${prenom}.pdf`;

      // Téléchargement du PDF
      // Si votre version de jsPDF supporte { returnPromise: true }, vous pouvez l'utiliser
      // pour déclencher l'alerte APRÈS la fin du téléchargement, mais cela dépend des versions.
      doc.save(fileName);

      // Message après téléchargement
      alert("Le PDF a été téléchargé. Veuillez envoyer ce fichier à la direction.");
    }
  </script>
</body>
</html>
